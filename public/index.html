<html>
<head>
    <title>Search Wiz</title>

<link rel="stylesheet" type="text/css" href="/style"></style>
</head>
<body>

<div class="content">

    <input type="text" class="search-input" name="search"><br><br><br>

    <input type="radio" id="by-keyword" name="searchtype" value="keyword" checked> by Keyword &nbsp; &nbsp;
    <input type="radio" id="by-id" name="searchtype" value="id"> by Id<br>
    <button class="search-button">Search</button>

    <div class="response"></div>
</div>
<div class="overlay start-hidden">
    <div id="spinner"></div>
</div>
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.7.0/underscore-min.js"></script>
<script>
    $(function() {

        $('.search-input').focus();

        function doSearch() {

            var input = $('.search-input').val();
            if(!input) {return false};
            input = input.replace(/ /g, '+');  // convert spaces to pluses

            function isNumber(obj) { return !isNaN(parseFloat(obj)) };

            if(isNumber(input)){
                $('#by-keyword').prop('checked', '');
                $('#by-id').prop('checked', 'checked');
            } else {
                $('#by-id').prop('checked', '');
                $('#by-keyword').prop('checked', 'checked');
            }

            $('.response').html( '' );
            $('.overlay').show();

            var searchType = $("input:radio[name ='searchtype']:checked").val();
            var url = (searchType === 'keyword') ? '/search/?q=' + input : '/search/track?id=' + input;

            $.ajax({
              url: url,
              type: 'post'
            })
            .error(function(){
                $('.response').html( 'no results found' );
                $('.overlay').hide();
            })
            .success(function( data ) {
                var output = '';
                if(data.id) {
                    var artUrl = data.artwork_url ? data.artwork_url : data.user.avatar_url;
                    output = '<div class="track"><img src="' + artUrl + '"><br>' + data.id + ' ' + data.title + '</div>';
                } else if(data.length){
                    _.each(data, function(song) {
                        var artUrl = song.artwork_url ? song.artwork_url : song.user.avatar_url;
                        output += '<div class="track"><img style="height:100px;width:100px;" src="' + artUrl + '"><br>' + song.id + ' ' + song.title + '</div>';
                    })
                } else {
                    output = 'no results found';
                }
                $('.response').html( output );
                $('.overlay').hide();
            });
        };

        $('.search-input').keyup(function(event){
            var code = event.which; // recommended to use e.which, it's normalized across browsers
            if(code==13){
                doSearch();
            }
        });

        $('.search-button').click(function() {
            doSearch();
        });

    });
</script>

</body>
</html>
